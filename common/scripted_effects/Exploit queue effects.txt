#Planet Scope
colonize_exploit_planet = {
	if = {
		limit = {
			NOT = { has_modifier = colonized_planet }
		}
		add_modifier = { modifier = colonized_planet }
	
		set_variable = { which = exploitation_size value = 0 }
		new_colony_setup = yes
		breakdown_deposits = yes
		exploit_size_set = yes
		if = {
			limit = {
				OR = {
					is_planet_class = pc_gas_giant
					is_planet_class = pc_asteroid
					is_planet_class = pc_ice_asteroid
				}
			}
			exploit_size_set = yes
		}
		if = {
			limit = {
				is_base_planet = yes
				base_planet_cost_check = yes
			}
			space_owner = {
				add_resource = {
					energy = @NegBaseEnergyCost
					alloys = @NegBaseAlloyCost
					minerals = @NegBaseMineralCost
				}
			}
		}
		else_if = {
			limit = {
				is_difficult_planet = yes
				difficult_planet_cost_check = yes
			}
			space_owner = {
				add_resource = {
					energy = @NegDifficultEnergyCost
					alloys = @NegDifficultAlloyCost
					minerals = @NegDifficultMineralCost
				}
			}
		}
		else_if = {
			limit = {
				is_vacuum_planet = yes
				vacuum_planet_cost_check = yes
			}
			space_owner = {
				add_resource = {
					energy = @NegVacuumEnergyCost
					alloys = @NegVacuumAlloyCost
					minerals = @NegVacuumMineralCost
				}
			}
		}
		if = {
			limit = {
				OR = {
					has_perm_flag = yes
					owner = { has_country_flag = exploit_automation }
				}
			}
			ai_colony_switch = yes
		}
	}
}

#Country Scope
mark_systems_develop = {
	set_timed_country_flag = { flag = recent_exploit_apply days = 30 }
	if = {
		limit = {
			OR = {
				NOT = { has_country_flag = exploit_spread }
				has_country_flag = exploit_spread_failed
			}
			any_system_within_border = {
				system_has_exploit = yes
				any_system_planet = {
					system_has_colonizeable_planet = yes
				}
			}
		}
		if = {
			limit = {
				has_country_flag = exploit_automation
				check_variable = { which = exploitation_centers value > 0 }
			}
			random_system_within_border = {
				limit = {
					OR = {
						any_system_planet = {
							is_hosting_exploit = yes
						}
						has_star_flag = exploit_queue_expand
					}
					any_system_planet = {
						system_has_colonizeable_planet = yes
					}
				}
				set_star_flag = exploit_colonize_target
				while = {
					limit = {
						PREV = { check_variable = { which = exploitation_centers value > 0 } }
						any_system_planet = {
							system_has_colonizeable_planet = yes
						}
					}
					PREV = { change_variable = { which = exploitation_centers value = -1 } }
					random_system_planet = {
						limit = {
							NOT = { has_modifier = colonized_planet }
							has_exploit_technology = yes
							can_build_exploit_colony = yes
							system_has_colonizeable_planet = yes							
						}
						set_planet_flag = exploit_colonize_target
					}
				}
				if = {
					limit = {
						PREV = { check_variable = { which = exploitation_centers value > 0 } }
						NOT = { 
							any_system_planet = {
								system_has_colonizeable_planet = yes
							}
						}
					}
					PREV = { country_event = { id = spaceexploitAI.1 days = 2 } }
				}
			}
		}
		else_if = { #TODO Select a system to do all the development in, leave colonies for later.
			limit = {
				NOT = { has_country_flag = exploit_automation }
				has_exploit_queue = yes
			}
			random_system_within_border = {
				limit = {
					OR = {
						any_system_planet = {
							is_hosting_exploit = yes
						}
						has_star_flag = exploit_queue_expand
					}
					any_system_planet = {
						system_has_colonizeable_planet = yes
					}
				}
				while = {
					count = 5
					limit = {
						PREV = { check_variable = { which = exploit_power_plant_queue value > 0 } }
						any_system_planet = {
							system_has_colonizeable_power_planet = yes
							NOT = { has_deposit_for = shipclass_research_station }
						}
					}
					PREV = { change_variable = { which = exploit_power_plant_queue value = -1 } }
					if = {
						limit = {
							any_system_planet = {
								system_has_colonizeable_power_planet = yes
								has_energy_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								system_has_colonizeable_power_planet = yes	
								has_energy_deposit = yes
							}
							set_planet_flag = exploit_power_loop
							set_planet_flag = exploit_colonize_target
						}						
					}
					else_if = {
						limit = {
							any_system_planet = {
								system_has_colonizeable_power_planet = yes
								has_deposit = no
							}
						}
						random_system_planet = {
							limit = {
								system_has_colonizeable_power_planet = yes	
								has_deposit = no
							}
							set_planet_flag = exploit_power_loop
							set_planet_flag = exploit_colonize_target
						}
					}
				}
				while = {
					count = 5
					limit = {		
						PREV = { check_variable = { which = exploit_mineral_mine_queue value > 0 } }
						any_system_planet = {
							system_has_colonizeable_mine_planet = yes
							NOT = { has_deposit_for = shipclass_research_station }
						}
					}
					PREV = { change_variable = { which = exploit_mineral_mine_queue value = -1 } }
					if = {
						limit = {
							any_system_planet = {
								system_has_colonizeable_mine_planet = yes	
								has_mineral_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								system_has_colonizeable_mine_planet = yes	
								has_mineral_deposit = yes
							}
							set_planet_flag = exploit_mine_loop
							set_planet_flag = exploit_colonize_target
						}						
					}
					else_if = {
						limit = {
							any_system_planet = {
								system_has_colonizeable_mine_planet = yes
								has_energy_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								system_has_colonizeable_mine_planet = yes	
								has_energy_deposit = yes
							}
							set_planet_flag = exploit_mine_loop
							set_planet_flag = exploit_colonize_target
						}						
					}
					else_if = {
						limit = {
							any_system_planet = {
								system_has_colonizeable_mine_planet = yes	
								has_deposit = no
							}
						}
						random_system_planet = {
							limit = {
								system_has_colonizeable_mine_planet = yes	
								has_deposit = no
							}
							set_planet_flag = exploit_mine_loop
							set_planet_flag = exploit_colonize_target
						}
					}
				}
				while = {
					count = 5
					limit = {
						PREV = { check_variable = { which = exploit_alloy_queue value > 0 } }
						any_system_planet = {
							system_has_colonizeable_alloy_planet = yes
							NOT = { has_deposit_for = shipclass_research_station }
						}
					}
					PREV = { change_variable = { which = exploit_alloy_queue value = -1 } }
					if = {
						limit = {
							any_system_planet = {
								system_has_colonizeable_alloy_planet = yes	
								has_alloy_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								system_has_colonizeable_alloy_planet = yes	
								has_alloy_deposit = yes
							}
							set_planet_flag = exploit_alloy_mine_loop
							set_planet_flag = exploit_colonize_target
						}						
					}
					else_if = {
						limit = {
							any_system_planet = {
								system_has_colonizeable_alloy_planet = yes
								has_energy_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								system_has_colonizeable_alloy_planet = yes	
								has_energy_deposit = yes
							}
							set_planet_flag = exploit_alloy_mine_loop
							set_planet_flag = exploit_colonize_target
						}						
					}
					else_if = {
						limit = {
							any_system_planet = {
								system_has_colonizeable_alloy_planet = yes	
								has_deposit = no
							}
						}
						random_system_planet = {
							limit = {
								system_has_colonizeable_alloy_planet = yes	
								has_deposit = no
							}
							set_planet_flag = exploit_alloy_mine_loop
							set_planet_flag = exploit_colonize_target
						}
					}
				}
				while = {
					count = 5
					limit = {
						PREV = { check_variable = { which = exploit_foundry_queue value > 0 } }
						any_system_planet = {
							system_has_colonizeable_foundry_planet = yes
							NOT = { has_deposit_for = shipclass_research_station }
						}
					}
					PREV = { change_variable = { which = exploit_foundry_queue value = -1 } }
					if = {
						limit = {
							any_system_planet = {
								system_has_colonizeable_foundry_planet = yes	
								has_alloy_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								system_has_colonizeable_foundry_planet = yes	
								has_alloy_deposit = yes
							}
							set_planet_flag = exploit_alloy_foundry_loop
							set_planet_flag = exploit_colonize_target
						}						
					}
					else_if = {
						limit = {
							any_system_planet = {
								system_has_colonizeable_foundry_planet = yes	
								has_mineral_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								system_has_colonizeable_foundry_planet = yes	
								has_mineral_deposit = yes
							}
							set_planet_flag = exploit_alloy_foundry_loop
							set_planet_flag = exploit_colonize_target
						}						
					}
					else_if = {
						limit = {
							any_system_planet = {
								system_has_colonizeable_foundry_planet = yes
								has_energy_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								system_has_colonizeable_foundry_planet = yes	
								has_energy_deposit = yes
							}
							set_planet_flag = exploit_alloy_foundry_loop
							set_planet_flag = exploit_colonize_target
						}						
					}
					else_if = {
						limit = {
							any_system_planet = {
								system_has_colonizeable_foundry_planet = yes	
								has_deposit = no
							}
						}
						random_system_planet = {
							limit = {
								system_has_colonizeable_foundry_planet = yes	
								has_deposit = no
							}
							set_planet_flag = exploit_alloy_foundry_loop
							set_planet_flag = exploit_colonize_target
						}
					}
				}
				while = {
					count = 5
					limit = {
						PREV = { check_variable = { which = exploit_lava_refinery_queue value > 0 } }
						any_system_planet = {
							system_has_colonizeable_lava_planet = yes
							NOT = { has_deposit_for = shipclass_research_station }
						}
					}
					PREV = { change_variable = { which = exploit_lava_refinery_queue value = -1 } }
					random_system_planet = {
						limit = {
							system_has_colonizeable_lava_planet = yes				
						}
						set_planet_flag = exploit_lava_refinery_loop
						set_planet_flag = exploit_colonize_target
					}
				}
				while = {
					count = 5
					limit = {
						PREV = { check_variable = { which = exploit_research_queue value > 0 } }
						any_system_planet = {
							system_has_colonizeable_research_planet = yes
							OR = {
								NOT = { has_deposit_for = shipclass_mining_station }
								has_energy_deposit = yes
							}
						}
					}
					PREV = { change_variable = { which = exploit_research_queue value = -1 } }
					if = {
						limit = {
							any_system_planet = {
								system_has_colonizeable_research_planet = yes	
								has_deposit_for = shipclass_research_station
							}
						}
						random_system_planet = {
							limit = {
								system_has_colonizeable_research_planet = yes	
								has_deposit_for = shipclass_research_station
							}
							set_planet_flag = exploit_research_loop
							set_planet_flag = exploit_colonize_target
						}						
					}
					else_if = {
						limit = {
							any_system_planet = {
								system_has_colonizeable_research_planet = yes	
								has_energy_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								system_has_colonizeable_research_planet = yes	
								has_energy_deposit = yes
							}
							set_planet_flag = exploit_research_loop
							set_planet_flag = exploit_colonize_target
						}						
					}
					else_if = {
						limit = {
							any_system_planet = {
								system_has_colonizeable_research_planet = yes	
								has_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								system_has_colonizeable_research_planet = yes	
								has_deposit = yes
							}
							set_planet_flag = exploit_research_loop
							set_planet_flag = exploit_colonize_target
						}						
					}
				}
				while = {
					count = 5
					limit = {
						PREV = { check_variable = { which = exploit_motes_queue value > 0 } }
						any_system_planet = {
							system_has_colonizeable_mote_planet = yes
							NOT = { has_deposit_for = shipclass_research_station }
						}
						owner = { has_technology = tech_mine_volatile_motes }
					}
					PREV = { change_variable = { which = exploit_motes_queue value = -1 } }
					if = {
						limit = {
							any_system_planet = {
								system_has_colonizeable_mote_planet = yes	
								has_motes_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								system_has_colonizeable_mote_planet = yes	
								has_motes_deposit = yes
							}
							set_planet_flag = exploit_motes_loop
							set_planet_flag = exploit_colonize_target
						}						
					}
					else_if = {
						limit = {
							any_system_planet = {
								system_has_colonizeable_mote_planet = yes
								has_energy_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								system_has_colonizeable_mote_planet = yes	
								has_energy_deposit = yes
							}
							set_planet_flag = exploit_motes_loop
							set_planet_flag = exploit_colonize_target
						}						
					}
					else_if = {
						limit = {
							any_system_planet = {
								system_has_colonizeable_mote_planet = yes	
								has_deposit = no
							}
						}
						random_system_planet = {
							limit = {
								system_has_colonizeable_mote_planet = yes	
								has_deposit = no
							}
							set_planet_flag = exploit_motes_loop
							set_planet_flag = exploit_colonize_target
						}
					}
				}
				while = {
					count = 5
					limit = {
						PREV = { check_variable = { which = exploit_gases_queue value > 0 } }
						any_system_planet = {
							system_has_colonizeable_gas_planet = yes
							NOT = { has_deposit_for = shipclass_research_station }
						}
						owner = { has_technology = tech_mine_exotic_gases }
					}
					PREV = { change_variable = { which = exploit_gases_queue value = -1 } }
					if = {
						limit = {
							any_system_planet = {
								system_has_colonizeable_gas_planet = yes	
								has_gas_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								system_has_colonizeable_gas_planet = yes	
								has_gas_deposit = yes
							}
							set_planet_flag = exploit_gases_loop
							set_planet_flag = exploit_colonize_target
						}						
					}
					else_if = {
						limit = {
							any_system_planet = {
								system_has_colonizeable_gas_planet = yes
								has_energy_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								system_has_colonizeable_gas_planet = yes	
								has_energy_deposit = yes
							}
							set_planet_flag = exploit_gases_loop
							set_planet_flag = exploit_colonize_target
						}						
					}
					else_if = {
						limit = {
							any_system_planet = {
								system_has_colonizeable_gas_planet = yes	
								has_deposit = no
							}
						}
						random_system_planet = {
							limit = {
								system_has_colonizeable_gas_planet = yes	
								has_deposit = no
							}
							set_planet_flag = exploit_gases_loop
							set_planet_flag = exploit_colonize_target
						}
					}
				}
				while = {
					count = 5
					limit = {
						PREV = { check_variable = { which = exploit_crystals_queue value > 0 } }
						any_system_planet = {
							system_has_colonizeable_crystal_planet = yes
							NOT = { has_deposit_for = shipclass_research_station }
						}
						owner = { has_technology = tech_mine_rare_crystals }
					}
					PREV = { change_variable = { which = exploit_crystals_queue value = -1 } }
					if = {
						limit = {
							any_system_planet = {
								system_has_colonizeable_crystal_planet = yes	
								has_crystal_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								system_has_colonizeable_crystal_planet = yes	
								has_crystal_deposit = yes
							}
							set_planet_flag = exploit_crystals_loop
							set_planet_flag = exploit_colonize_target
						}						
					}
					else_if = {
						limit = {
							any_system_planet = {
								system_has_colonizeable_crystal_planet = yes
								has_energy_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								system_has_colonizeable_crystal_planet = yes	
								has_energy_deposit = yes
							}
							set_planet_flag = exploit_crystals_loop
							set_planet_flag = exploit_colonize_target
						}						
					}
					else_if = {
						limit = {
							any_system_planet = {
								system_has_colonizeable_crystal_planet = yes	
								has_deposit = no
							}
						}
						random_system_planet = {
							limit = {
								system_has_colonizeable_crystal_planet = yes	
								has_deposit = no
							}
							set_planet_flag = exploit_crystals_loop
							set_planet_flag = exploit_colonize_target
						}
					}
				}
			}
		}
		if = {
			limit = {
				OR = {
					AND = {
						has_country_flag = exploit_automation
						check_variable = { which = exploitation_centers value > 0 }
					}
					has_exploit_queue = yes
				}
			}
			country_event = { id = spaceexploitAI.1 days = 2 }
		}
		remove_country_flag = exploit_spread_failed
	}
	else_if = {
		limit = {
			NOT = { has_country_flag = exploit_spread }
			any_system_within_border = {
				system_has_viable_exploit_host = yes
				any_system_planet = {
					system_has_colonizeable_planet = yes
				}
			}
		}
		random_system_within_border = {
			limit = {
				system_has_viable_exploit_host = yes
				any_system_planet = {
					system_has_colonizeable_planet = yes
				}
			}
			set_star_flag = exploit_queue_expand
		}
		country_event = { id = spaceexploitAI.1 days = 2 }
	}
	
	
	else_if = {
		limit = {
			has_country_flag = exploit_spread
			any_system_within_border = {
				system_has_viable_exploit_host = yes
				system_has_colonizeable_planet = yes
			}
		}
		if = {
			limit = {
				has_country_flag = exploit_automation
				check_variable = { which = exploitation_centers value > 0 }
			}
			while = {
				limit = {
					any_system_within_border = {
						system_has_viable_exploit_host = yes
						any_system_planet = {
							system_has_colonizeable_planet = yes
						}
					}
					check_variable = { which = exploitation_centers value > 0 }
				}
				change_variable = { which = exploitation_centers value = -1 }
				random_system_within_border = {
					limit = {
						system_has_viable_exploit_host = yes
						any_system_planet = {
							system_has_colonizeable_planet = yes
						}
					}
					random_system_planet = {
						limit = {
							system_has_colonizeable_planet = yes					
						}
						set_planet_flag = exploit_colonize_target
					}
				}
			}
		}
		else_if = { #TODO Mark the systems only, not mark the colony in each one.
			limit = {
				NOT = { has_country_flag = exploit_automation }
				has_exploit_queue = yes
				any_system_within_border = {
					system_has_viable_exploit_host = yes
					any_system_planet = {
						system_has_colonizeable_planet = yes
					}
				}
			}
			while = {
				count = 5
				limit = {
					check_variable = { which = exploit_power_plant_queue value > 0 }
					any_system_within_border = {
						system_has_viable_exploit_host = yes
						any_system_planet = {
							system_has_colonizeable_power_planet = yes
							NOT = { has_deposit_for = shipclass_research_station }
						}
					}
				}
				change_variable = { which = exploit_power_plant_queue value = -1 }
				random_system_within_border = {
					limit = {
						system_has_viable_exploit_host = yes
						any_system_planet = {
							system_has_colonizeable_power_planet = yes
							NOT = { has_deposit_for = shipclass_research_station }
						}
					}
					if = {
						limit = {
							any_system_planet = {
								NOT = { has_modifier = colonized_planet }
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_power_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_energy_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								NOT = { has_modifier = colonized_planet }
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_power_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_energy_deposit = yes
							}
							set_planet_flag = exploit_power_loop
							set_planet_flag = exploit_colonize_target
						}
					}
					else_if = {
						limit = {
							any_system_planet = {
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_power_planet = yes
								has_deposit = no
							}
						}
						random_system_planet = {
							limit = {
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_power_planet = yes
								has_deposit = no
							}
							set_planet_flag = exploit_power_loop
							set_planet_flag = exploit_colonize_target
						}
					}
				}
			}
			while = {
				count = 5
				limit = {		
					check_variable = { which = exploit_mineral_mine_queue value > 0 }
					any_system_within_border = {
						system_has_viable_exploit_host = yes
						any_system_planet = {
							system_has_colonizeable_mine_planet = yes
							NOT = { has_deposit_for = shipclass_research_station }
						}
					}
				}
				change_variable = { which = exploit_mineral_mine_queue value = -1 }
				random_system_within_border = {
					limit = {
						system_has_viable_exploit_host = yes
						any_system_planet = {
							system_has_colonizeable_mine_planet = yes
							NOT = { has_deposit_for = shipclass_research_station }
						}
					}
					if = {
						limit = {
							any_system_planet = {
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_mine_planet = yes
								has_mineral_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_mine_planet = yes
								has_mineral_deposit = yes
							}
							set_planet_flag = exploit_mine_loop
							set_planet_flag = exploit_colonize_target
						}
					}
					else_if = {
						limit = {
							any_system_planet = {
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_mine_planet = yes
								has_energy_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_mine_planet = yes
								has_energy_deposit = yes
							}
							set_planet_flag = exploit_mine_loop
							set_planet_flag = exploit_colonize_target
						}
					}
					else_if = {
						limit = {
							any_system_planet = {
								NOT = { has_modifier = colonized_planet }
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_mine_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_deposit = no
							}
						}
						random_system_planet = {
							limit = {
								NOT = { has_modifier = colonized_planet }
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_mine_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_deposit = no
							}
							set_planet_flag = exploit_mine_loop
							set_planet_flag = exploit_colonize_target
						}
					}
				}
			}
			while = {
				count = 5
				limit = {
					check_variable = { which = exploit_alloy_queue value > 0 }
					any_system_within_border = {
						system_has_viable_exploit_host = yes
						any_system_planet = {
							system_has_colonizeable_alloy_planet = yes
							NOT = { has_deposit_for = shipclass_research_station }
						}
					}
				}
				change_variable = { which = exploit_alloy_queue value = -1 }
				random_system_within_border = {
					limit = {
						system_has_viable_exploit_host = yes
						any_system_planet = {
							system_has_colonizeable_alloy_planet = yes
							NOT = { has_deposit_for = shipclass_research_station }
						}
					}
					if = {
						limit = {
							any_system_planet = {
								NOT = { has_modifier = colonized_planet }
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_alloy_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_alloy_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_alloy_planet = yes
								has_alloy_deposit = yes
							}
							set_planet_flag = exploit_alloy_mine_loop
							set_planet_flag = exploit_colonize_target
						}
					}
					else_if = {
						limit = {
							any_system_planet = {
								NOT = { has_modifier = colonized_planet }
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_alloy_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_energy_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_alloy_planet = yes
								has_energy_deposit = yes
							}
							set_planet_flag = exploit_alloy_mine_loop
							set_planet_flag = exploit_colonize_target
						}
					}
					else_if = {
						limit = {
							any_system_planet = {
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_alloy_planet = yes
								has_deposit = no
							}
						}
						random_system_planet = {
							limit = {
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_alloy_planet = yes
								has_deposit = no
							}
							set_planet_flag = exploit_alloy_mine_loop
							set_planet_flag = exploit_colonize_target
						}
					}
				}
			}
			while = {
				count = 5
				limit = {
					check_variable = { which = exploit_foundry_queue value > 0 }
					any_system_within_border = {
						system_has_viable_exploit_host = yes
						any_system_planet = {
							system_has_colonizeable_planet = yes
							NOT = { has_deposit_for = shipclass_research_station }
						}
					}
				}
				change_variable = { which = exploit_foundry_queue value = -1 }
				random_system_within_border = {
					limit = {
						system_has_viable_exploit_host = yes
						any_system_planet = {
							system_has_colonizeable_planet = yes
							NOT = { has_deposit_for = shipclass_research_station }
						}
					}
					if = {
						limit = {
							any_system_planet = {
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_planet = yes
								has_alloy_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_planet = yes
								has_alloy_deposit = yes
							}
							set_planet_flag = exploit_alloy_foundry_loop
							set_planet_flag = exploit_colonize_target
						}
					}
					else_if = {
						limit = {
							any_system_planet = {
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_planet = yes
								has_mineral_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_planet = yes
								has_mineral_deposit = yes
							}
							set_planet_flag = exploit_alloy_foundry_loop
							set_planet_flag = exploit_colonize_target
						}
					}
					else_if = {
						limit = {
							any_system_planet = {
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_planet = yes
								has_energy_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_planet = yes
								has_energy_deposit = yes
							}
							set_planet_flag = exploit_alloy_foundry_loop
							set_planet_flag = exploit_colonize_target
						}
					}
					else_if = {
						limit = {
							any_system_planet = {
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_planet = yes
								has_deposit = no
							}
						}
						random_system_planet = {
							limit = {
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_planet = yes
								has_deposit = no
							}
							set_planet_flag = exploit_alloy_foundry_loop
							set_planet_flag = exploit_colonize_target
						}
					}
				}
			}
			while = {
				count = 5
				limit = {
					check_variable = { which = exploit_lava_refinery_queue value > 0 }
					any_system_within_border = {
						system_has_viable_exploit_host = yes
						any_system_planet = {
							system_has_colonizeable_lava_planet = yes
							NOT = { has_deposit_for = shipclass_research_station }
						}
					}
				}
				change_variable = { which = exploit_lava_refinery_queue value = -1 }
				random_system_within_border = {
					limit = {
						system_has_viable_exploit_host = yes
						any_system_planet = {
							system_has_colonizeable_lava_planet = yes
							NOT = { has_deposit_for = shipclass_research_station }
						}
					}
					random_system_planet = {
						limit = {
							system_has_colonizeable_lava_planet = yes	
							NOT = { has_deposit_for = shipclass_research_station }				
						}
						set_planet_flag = exploit_lava_refinery_loop
						set_planet_flag = exploit_colonize_target
					}
				}
			}
			while = {
				count = 5
				limit = {
					check_variable = { which = exploit_research_queue value > 0 }
					any_system_within_border = {
						system_has_viable_exploit_host = yes
						any_system_planet = {
							system_has_colonizeable_planet = yes
							NOT = { has_deposit_for = shipclass_mining_station }
						}
					}
				}
				change_variable = { which = exploit_research_queue value = -1 }
				random_system_within_border = {
					limit = {
						system_has_viable_exploit_host = yes
						any_system_planet = {
							system_has_colonizeable_planet = yes
							OR = {
								NOT = { has_deposit_for = shipclass_mining_station }
								has_energy_deposit = yes
							}
						}
					}
					if = {
						limit = {
							any_system_planet = {
								NOT = { has_modifier = colonized_planet }
								OR = {
									NOT = { has_deposit_for = shipclass_mining_station }
									has_energy_deposit = yes
								}
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_science_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								NOT = { has_modifier = colonized_planet }
								OR = {
									NOT = { has_deposit_for = shipclass_mining_station }
									has_energy_deposit = yes
								}
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_science_deposit = yes
							}
							set_planet_flag = exploit_research_loop
							set_planet_flag = exploit_colonize_target
						}
					}
					else_if = {
						limit = {
							any_system_planet = {
								NOT = { has_modifier = colonized_planet }
								OR = {
									NOT = { has_deposit_for = shipclass_mining_station }
									has_energy_deposit = yes
								}
								system_has_colonizeable_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_energy_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								NOT = { has_modifier = colonized_planet }
								OR = {
									NOT = { has_deposit_for = shipclass_mining_station }
									has_energy_deposit = yes
								}
								system_has_colonizeable_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_energy_deposit = yes
							}
							set_planet_flag = exploit_research_loop
							set_planet_flag = exploit_colonize_target
						}
					}
					else_if = {
						limit = {
							any_system_planet = {
								NOT = { has_modifier = colonized_planet }
								OR = {
									NOT = { has_deposit_for = shipclass_mining_station }
									has_energy_deposit = yes
								}
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_deposit = no
							}
						}
						random_system_planet = {
							limit = {
								NOT = { has_modifier = colonized_planet }
								OR = {
									NOT = { has_deposit_for = shipclass_mining_station }
									has_energy_deposit = yes
								}
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_deposit = no
							}
							set_planet_flag = exploit_research_loop
							set_planet_flag = exploit_colonize_target
						}
					}
				}
			}
			while = {
				count = 5
				limit = {
					check_variable = { which = exploit_motes_queue value > 0 }
					any_system_within_border = {
						system_has_viable_exploit_host = yes
						any_system_planet = {
							system_has_colonizeable_mote_planet = yes
							NOT = { has_deposit_for = shipclass_research_station }
						}
					}
					owner = { has_technology = tech_mine_volatile_motes }
				}
				change_variable = { which = exploit_motes_queue value = -1 }
				random_system_within_border = {
					limit = {
						system_has_viable_exploit_host = yes
						any_system_planet = {
							system_has_colonizeable_mote_planet = yes
							NOT = { has_deposit_for = shipclass_research_station }
						}
					}
					if = {
						limit = {
							any_system_planet = {
								NOT = { has_modifier = colonized_planet }
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_mote_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_gas_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								NOT = { has_modifier = colonized_planet }
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_mote_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_gas_deposit = yes
							}
							set_planet_flag = exploit_motes_loop
							set_planet_flag = exploit_colonize_target
						}
					}
					else_if = {
						limit = {
							any_system_planet = {
								NOT = { has_modifier = colonized_planet }
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_mote_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_energy_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								NOT = { has_modifier = colonized_planet }
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_mote_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_energy_deposit = yes
							}
							set_planet_flag = exploit_motes_loop
							set_planet_flag = exploit_colonize_target
						}
					}
					else_if = {
						limit = {
							any_system_planet = {
								NOT = { has_modifier = colonized_planet }
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_mote_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_deposit = no
							}
						}
						random_system_planet = {
							limit = {
								NOT = { has_modifier = colonized_planet }
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_mote_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_deposit = no
							}
							set_planet_flag = exploit_motes_loop
							set_planet_flag = exploit_colonize_target
						}
					}
				}
			}
			while = {
				count = 5
				limit = {
					check_variable = { which = exploit_gases_queue value > 0 }
					any_system_within_border = {
						system_has_viable_exploit_host = yes
						any_system_planet = {
							system_has_colonizeable_gas_planet = yes
							NOT = { has_deposit_for = shipclass_research_station }
						}
					}
					owner = { has_technology = tech_mine_exotic_gases }
				}
				change_variable = { which = exploit_gases_queue value = -1 }
				random_system_within_border = {
					limit = {
						system_has_viable_exploit_host = yes
						any_system_planet = {
							system_has_colonizeable_gas_planet = yes
							NOT = { has_deposit_for = shipclass_research_station }
						}
					}
					if = {
						limit = {
							any_system_planet = {
								NOT = { has_modifier = colonized_planet }
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_gas_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_gas_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								NOT = { has_modifier = colonized_planet }
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_gas_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_gas_deposit = yes
							}
							set_planet_flag = exploit_gases_loop
							set_planet_flag = exploit_colonize_target
						}
					}
					else_if = {
						limit = {
							any_system_planet = {
								NOT = { has_modifier = colonized_planet }
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_gas_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_energy_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								NOT = { has_modifier = colonized_planet }
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_gas_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_energy_deposit = yes
							}
							set_planet_flag = exploit_gases_loop
							set_planet_flag = exploit_colonize_target
						}
					}
					else_if = {
						limit = {
							any_system_planet = {
								NOT = { has_modifier = colonized_planet }
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_gas_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_deposit = no
							}
						}
						random_system_planet = {
							limit = {
								NOT = { has_modifier = colonized_planet }
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_gas_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_deposit = no
							}
							set_planet_flag = exploit_gases_loop
							set_planet_flag = exploit_colonize_target
						}
					}
				}
			}
			while = {
				count = 5
				limit = {
					check_variable = { which = exploit_crystals_queue value > 0 }
					any_system_within_border = {
						system_has_viable_exploit_host = yes
						any_system_planet = {
							system_has_colonizeable_crystal_planet = yes
							NOT = { has_deposit_for = shipclass_research_station }
						}
					}
					owner = { has_technology = tech_mine_rare_crystals }
				}
				change_variable = { which = exploit_crystals_queue value = -1 }
				random_system_within_border = {
					limit = {
						system_has_viable_exploit_host = yes
						any_system_planet = {
							system_has_colonizeable_crystal_planet = yes
							NOT = { has_deposit_for = shipclass_research_station }
						}
					}
					if = {
						limit = {
							any_system_planet = {
								NOT = { has_modifier = colonized_planet }
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_crystal_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_crystal_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								NOT = { has_modifier = colonized_planet }
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_crystal_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_crystal_deposit = yes
							}
							set_planet_flag = exploit_crystals_loop
							set_planet_flag = exploit_colonize_target
						}
					}
					else_if = {
						limit = {
							any_system_planet = {
								NOT = { has_modifier = colonized_planet }
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_crystal_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_energy_deposit = yes
							}
						}
						random_system_planet = {
							limit = {
								NOT = { has_modifier = colonized_planet }
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_crystal_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_energy_deposit = yes
							}
							set_planet_flag = exploit_crystals_loop
							set_planet_flag = exploit_colonize_target
						}
					}
					else_if = {
						limit = {
							any_system_planet = {
								NOT = { has_modifier = colonized_planet }
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_crystal_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_deposit = no
							}
						}
						random_system_planet = {
							limit = {
								NOT = { has_modifier = colonized_planet }
								NOT = { has_deposit_for = shipclass_research_station }
								system_has_colonizeable_crystal_planet = yes
								has_exploit_technology = yes
								can_build_exploit_colony = yes
								has_deposit = no
							}
							set_planet_flag = exploit_crystals_loop
							set_planet_flag = exploit_colonize_target
						}
					}
				}
			}
		}
		if = {
			limit = {
				OR = {
					AND = {
						has_country_flag = exploit_automation
						check_variable = { which = exploitation_centers value > 0 }
					}
					has_exploit_queue = yes
				}
			}
			country_event = { id = spaceexploitAI.1 days = 2 }
		}
	}
	else = {
		set_country_flag = exploit_spread_failed
		country_event = { id = spaceexploitAI.1 days = 2 }
	}
	country_event = { id = spaceexploitAI.2 days = 5 }  #TODO Event to distribute selected constructions
}

#Country Scope
calculate_allowed_exploits = {
	set_variable = { which = exploitation_centers value = 0 }
	set_country_flag = exploitation_set
	every_owned_planet = {
		limit = {
			is_major_colony = yes
		}
		PREV = { change_variable = { which = exploitation_centers value = 3 } }
		if = {
			limit = {
				years_passed > 5
			}
			PREV = { change_variable = { which = exploitation_centers value = 1 } }
		}
		if = {
			limit = {
				years_passed > 10
			}
			PREV = { change_variable = { which = exploitation_centers value = 1 } }
		}
		if = {
			limit = {
				years_passed > 15
			}
			PREV = { change_variable = { which = exploitation_centers value = 1 } }
		}
		if = {
			limit = {
				years_passed > 20
			}
			PREV = { change_variable = { which = exploitation_centers value = 1 } }
		}
	}
	if = {
		limit = {
			is_ai = yes
		}
		if = {
			limit = {
				has_global_flag = exploit_speed_difficulty
			}
			switch = {
				trigger = is_difficulty
				0 = {
					multiply_variable = { which = exploitation_centers value = 0.5 }
				}
				1 = {
				}
				2 = {
					multiply_variable = { which = exploitation_centers value = 2 }
				}
				3 = {
					multiply_variable = { which = exploitation_centers value = 3 }
				}
				4 = {
					multiply_variable = { which = exploitation_centers value = 4 }
				}
				5 = {
					multiply_variable = { which = exploitation_centers value = 5 }
				}
			}
		}
		else_if = {
			limit = {
				has_global_flag = exploit_speed_manual
			}
			switch = {
				trigger = has_global_flag
				exploit_ai_speed_5_neg = {
					divide_variable = { which = exploitation_centers value = 6 }
				}
				exploit_ai_speed_4_neg = {
					divide_variable = { which = exploitation_centers value = 5 }
				}
				exploit_ai_speed_3_neg = {
					divide_variable = { which = exploitation_centers value = 4 }
				}
				exploit_ai_speed_2_neg = {
					divide_variable = { which = exploitation_centers value = 3 }
				}
				exploit_ai_speed_1_neg = {
					divide_variable = { which = exploitation_centers value = 2 }
				}
				
				exploit_ai_speed_1 = {
					multiply_variable = { which = exploitation_centers value = 2 }
				}
				exploit_ai_speed_2 = {
					multiply_variable = { which = exploitation_centers value = 3 }
				}
				exploit_ai_speed_3 = {
					multiply_variable = { which = exploitation_centers value = 4 }
				}
				exploit_ai_speed_4 = {
					multiply_variable = { which = exploitation_centers value = 5 }
				}
				exploit_ai_speed_5 = {
					multiply_variable = { which = exploitation_centers value = 6 }
				}
			}
		}
		else = {
		}
	}
	every_planet_within_border = {
		limit = {
			has_modifier = colonized_planet
			OR = {
				has_modifier = building_thing
				has_perm_flag = yes
			}
		}
		PREV = { change_variable = { which = exploitation_centers value = -1 } }
	}
}

#Planet Scope
exploit_build_time_calc = {
	if = {
		limit = {
			check_variable = { which = exploit_build_time value >= 90 }
		}
		planet_event = { id = $exploit_build_time_event$ days = 90 }
		set_variable = { which = exploit_build_progress value = 90 }
		multiply_variable = { which = exploit_build_progress value = space_owner.realdev_minor_colony_speed }
		subtract_variable = { which = exploit_build_time value = exploit_build_progress }
	}
	else_if = {
		limit = {
			check_variable = { which = exploit_build_time value >= 60 }
		}
		planet_event = { id = $exploit_build_time_event$ days = 60 }
		set_variable = { which = exploit_build_progress value = 60 }
		multiply_variable = { which = exploit_build_progress value = space_owner.realdev_minor_colony_speed }
		subtract_variable = { which = exploit_build_time value = exploit_build_progress }
	}
	else_if = {
		limit = {
			check_variable = { which = exploit_build_time value >= 30 }
		}
		planet_event = { id = $exploit_build_time_event$ days = 30 }
		set_variable = { which = exploit_build_progress value = 30 }
		multiply_variable = { which = exploit_build_progress value = space_owner.realdev_minor_colony_speed }
		subtract_variable = { which = exploit_build_time value = exploit_build_progress }
	}
	else_if = {
		limit = {
			check_variable = { which = exploit_build_time value >= 15 }
		}
		planet_event = { id = $exploit_build_time_event$ days = 15 }
		set_variable = { which = exploit_build_progress value = 15 }
		multiply_variable = { which = exploit_build_progress value = space_owner.realdev_minor_colony_speed }
		subtract_variable = { which = exploit_build_time value = exploit_build_progress }
	}
	else_if = {
		limit = {
			check_variable = { which = exploit_build_time value >= 5 }
		}
		planet_event = { id = $exploit_build_time_event$ days = 5 }
		set_variable = { which = exploit_build_progress value = 5 }
		multiply_variable = { which = exploit_build_progress value = space_owner.realdev_minor_colony_speed }
		subtract_variable = { which = exploit_build_time value = exploit_build_progress }
	}
	else_if = {
		limit = {
			check_variable = { which = exploit_build_time value < 5 }
			check_variable = { which = exploit_build_time value > 0 }
		}
		planet_event = { id = $exploit_build_time_event$ days = 3 }
		set_variable = { which = exploit_build_time value = 0 }
	}
}

#Planet Scope
exploit_mine_loop = {
	if = {
		limit = {
			NOT = { has_planet_flag = exploit_mine_loop }
		}
		set_planet_flag = exploit_mine_loop
	}
	if = {
		limit = {
			exploit_already_building = yes
			NOT = { has_planet_flag = exploit_building_power }
		}
		if = {
			limit = {
				check_variable = { which = exploit_build_time value = 0 }
			}
			planet_event = { id = spaceexploit.1 days = 1 }
			planet_event = { id = spaceexploit.102 }
		}
		else = {
			exploit_build_time_calc = {
				exploit_build_event = spaceexploit.1
			}
		}
	}
	else_if = {
		limit = {
			exploit_already_building = yes
			has_planet_flag = exploit_building_power
		}
		if = {
			limit = {
				check_variable = { which = exploit_build_time value = 0 }
			}
			planet_event = { id = spaceexploit.1 days = 1 }
			planet_event = { id = spaceexploit.202 }
		}
		else = {
			exploit_build_time_calc = {
				exploit_build_event = spaceexploit.1
			}
		}
	}
	else_if = {
		limit = {
			has_colony_and_space = yes
			can_build_exploit_mine = yes
		}
		add_modifier = { modifier = building_thing }
		set_planet_flag = all_under_construction
		set_planet_flag = exploit_building_mines
		pay_exploit_mine = yes
		planet_event = { id = spaceexploit.1 }
		set_variable = { which = exploit_build_time value = @ConstructionTime }
	}
	else_if = {
		limit = {
			can_build_exploit_power = yes
			count_deposits = { type = d_energy_1 count < 1 }
			check_variable = { which = exploitation_size value > 1 }
		}
		pay_exploit_power = yes
		set_planet_flag = exploit_building_power
		planet_event = { id = spaceexploit.1 }
		set_variable = { which = exploit_build_time value = @ConstructionTime }
	}
	else_if = {
		limit = {
			check_variable = { which = exploitation_size value < 2 }
		}
	}
	else = {
		planet_event = { id = spaceexploit.1 days = @ConstructionTime }
	}
}
exploit_power_loop = {
	if = {
		limit = {
			NOT = { has_planet_flag = exploit_power_loop }
		}
		set_planet_flag = exploit_power_loop
	}
	if = {
		limit = {
			exploit_already_building = yes
			NOT = { has_planet_flag = exploit_building_power }
		}
		if = {
			limit = {
				check_variable = { which = exploit_build_time value = 0 }
			}
			planet_event = { id = spaceexploit.2 days = 1 }
			planet_event = { id = spaceexploit.202 }
		}
		else = {
			exploit_build_time_calc = {
				exploit_build_event = spaceexploit.2
			}
		}
	}
	else_if = {
		limit = {
			can_build_exploit_power = yes
		}
		add_modifier = { modifier = building_thing }
		set_planet_flag = all_under_construction
		set_planet_flag = exploit_building_power
		pay_exploit_power = yes
		planet_event = { id = spaceexploit.2 days = 91 }
		planet_event = { id = spaceexploit.202 days = @ConstructionTime }
	}
	else_if = {
		limit = {
			check_variable = { which = exploitation_size value < 1 }
		}
	}
	else = {
		planet_event = { id = spaceexploit.2 days = @ConstructionTime }
	}		
}
exploit_alloy_mine_loop = {
	if = {
		limit = {
			NOT = { has_planet_flag = exploit_alloy_mine_loop }
		}
		set_planet_flag = exploit_alloy_mine_loop
	}
	if = {
		limit = {
			exploit_already_building = yes
			NOT = { has_planet_flag = exploit_building_power }
		}
		if = {
			limit = {
				check_variable = { which = exploit_build_time value = 0 }
			}
			planet_event = { id = spaceexploit.5 days = 1 }
			planet_event = { id = spaceexploit.502 }
		}
		else = {
			exploit_build_time_calc = {
				exploit_build_event = spaceexploit.5
			}
		}
	}
	else_if = {
		limit = {
			exploit_already_building = yes
			has_planet_flag = exploit_building_power
		}
		if = {
			limit = {
				check_variable = { which = exploit_build_time value = 0 }
			}
			planet_event = { id = spaceexploit.5 days = 1 }
			planet_event = { id = spaceexploit.202 }
		}
		else = {
			exploit_build_time_calc = {
				exploit_build_event = spaceexploit.5
			}
		}
	}
	else_if = {
		limit = {
			can_build_exploit_alloy_mine = yes
		}
		add_modifier = { modifier = building_thing }
		set_planet_flag = all_under_construction
		set_planet_flag = exploit_building_alloys
		pay_exploit_alloy_mine = yes
		planet_event = { id = spaceexploit.5 days = 91 }
		planet_event = { id = spaceexploit.502 days = @ConstructionTime }
	}
	else_if = {
		limit = {
			can_build_exploit_power = yes
			count_deposits = { type = d_energy_1 count < 1 }
			check_variable = { which = exploitation_size value > 1 }
		}
		pay_exploit_power = yes
		planet_event = { id = spaceexploit.5 days = 91 }
		planet_event = { id = spaceexploit.202 days = @ConstructionTime }
	}
	else_if = {
		limit = {
			check_variable = { which = exploitation_size value < 2 }
		}
	}
	else = {
		planet_event = { id = spaceexploit.5 days = @ConstructionTime }
	}
}
exploit_alloy_foundry_loop = {
	if = {
		limit = {
			NOT = { has_planet_flag = exploit_alloy_foundry_loop }
		}
		set_planet_flag = exploit_alloy_foundry_loop
	}
	if = {
		limit = {
			exploit_already_building = yes
			NOT = { has_planet_flag = exploit_building_power }
		}
		if = {
			limit = {
				check_variable = { which = exploit_build_time value = 0 }
			}
			planet_event = { id = spaceexploit.4 days = 1 }
			planet_event = { id = spaceexploit.402 }
		}
		else = {
			exploit_build_time_calc = {
				exploit_build_event = spaceexploit.4
			}
		}
	}
	else_if = {
		limit = {
			exploit_already_building = yes
			has_planet_flag = exploit_building_power
		}
		if = {
			limit = {
				check_variable = { which = exploit_build_time value = 0 }
			}
			planet_event = { id = spaceexploit.4 days = 1 }
			planet_event = { id = spaceexploit.202 }
		}
		else = {
			exploit_build_time_calc = {
				exploit_build_event = spaceexploit.4
			}
		}
	}
	else_if = {
		limit = {
			can_build_exploit_alloy_foundry = yes
		}
		add_modifier = { modifier = building_thing }
		set_planet_flag = all_under_construction
		set_planet_flag = exploit_building_foundry
		pay_exploit_alloy_foundry = yes
		planet_event = { id = spaceexploit.4 days = 91 }
		planet_event = { id = spaceexploit.402 days = @ConstructionTime }
	}
	else_if = {
		limit = {
			can_build_exploit_power = yes
			count_deposits = { type = d_energy_1 count < 1 }
			check_variable = { which = exploitation_size value > 3 }
		}
		pay_exploit_power = yes
		planet_event = { id = spaceexploit.4 days = 91 }
		planet_event = { id = spaceexploit.202 days = @ConstructionTime }
	}
	else_if = {
		limit = {
			OR = {
				AND = {
					count_deposits = { type = d_minerals_1 count < 2 }
					check_variable = { which = exploitation_size value > 2 }
				}
				AND = {
					count_deposits = { type = d_minerals_1 count < 1 }
					check_variable = { which = exploitation_size value > 1 }				
				}
			}
		}
		pay_exploit_mine = yes
		planet_event = { id = spaceexploit.4 days = 91 }
		planet_event = { id = spaceexploit.102 days = @ConstructionTime }
	}
	else_if = {
		limit = {
			check_variable = { which = exploitation_size value < 4 }
		}
	}
	else = {
		planet_event = { id = spaceexploit.4 days = @ConstructionTime }
	}
}
exploit_lava_refinery_loop = {
	if = {
		limit = {
			NOT = { has_planet_flag = exploit_lava_refinery_loop }
		}
		set_planet_flag = exploit_lava_refinery_loop
	}
	if = {
		limit = {
			exploit_already_building = yes
		}
		if = {
			limit = {
				check_variable = { which = exploit_build_time value = 0 }
			}
			planet_event = { id = spaceexploit.10 days = 1 }
			planet_event = { id = spaceexploit.1002 }
		}
		else = {
			exploit_build_time_calc = {
				exploit_build_event = spaceexploit.10
			}
		}
	}
	else_if = {
		limit = {
			can_build_exploit_lava_refinery = yes
		}
		add_modifier = { modifier = building_thing }
		set_planet_flag = all_under_construction
		set_planet_flag = exploit_building_lava
		pay_exploit_lava_refinery = yes
		planet_event = { id = spaceexploit.10 days = 91 }
		planet_event = { id = spaceexploit.1002 days = @ConstructionTime }
	}
	else_if = {
		limit = {
			check_variable = { which = exploitation_size value < 1 }
		}
	}
	else = {
		planet_event = { id = spaceexploit.10 days = @ConstructionTime }
	}
}
exploit_research_loop = {
	if = {
		limit = {
			NOT = { has_planet_flag = exploit_research_loop }
		}
		set_planet_flag = exploit_research_loop
	}
	if = {
		limit = {
			can_build_exploit_research = yes
		}
		add_modifier = { modifier = building_thing }
		set_planet_flag = all_under_construction
		set_planet_flag = exploit_building_research
		pay_exploit_research = yes
		planet_event = { id = spaceexploit.12 days = 91 }
		planet_event = { id = spaceexploit.1202 days = @ConstructionTime }
	}
	else_if = {
		limit = {
			can_build_exploit_power = yes
			count_deposits = { type = d_energy_1 count < 2 }
			check_variable = { which = exploitation_size value > 1 }
		}
		pay_exploit_power = yes
		planet_event = { id = spaceexploit.12 days = 91 }
		planet_event = { id = spaceexploit.202 days = @ConstructionTime }
	}
	else_if = {
		limit = {
			check_variable = { which = exploitation_size value < 2 }
		}
	}
	else = {
		planet_event = { id = spaceexploit.12 days = @ConstructionTime }
	}
}
exploit_motes_loop = {
	if = {
		limit = {
			NOT = { has_planet_flag = exploit_motes_loop }
		}
		set_planet_flag = exploit_motes_loop
	}
	if = {
		limit = {
			can_build_exploit_motes = yes
		}
		add_modifier = { modifier = building_thing }
		set_planet_flag = all_under_construction
		set_planet_flag = exploit_building_motes
		pay_exploit_motes = yes
		planet_event = { id = spaceexploit.7 days = 91 }
		planet_event = { id = spaceexploit.702 days = @ConstructionTime }
	}
	else_if = {
		limit = {
			can_build_exploit_power = yes
			count_deposits = { type = d_energy_1 count < 1 }
			check_variable = { which = exploitation_size value > 1 }
		}
		pay_exploit_power = yes
		planet_event = { id = spaceexploit.7 days = 91 }
		planet_event = { id = spaceexploit.202 days = @ConstructionTime }
	}
	else_if = {
		limit = {
			check_variable = { which = exploitation_size value < 2 }
		}
	}
	else = {
		planet_event = { id = spaceexploit.7 days = @ConstructionTime }
	}
}
exploit_gases_loop = {
	if = {
		limit = {
			NOT = { has_planet_flag = exploit_gases_loop }
		}
		set_planet_flag = exploit_gases_loop
	}
	if = {
		limit = {
			can_build_exploit_gases = yes
		}
		add_modifier = { modifier = building_thing }
		set_planet_flag = all_under_construction
		set_planet_flag = exploit_building_gases
		pay_exploit_gases = yes
		planet_event = { id = spaceexploit.9 days = 91 }
		planet_event = { id = spaceexploit.902 days = @ConstructionTime }	
	}
	else_if = {
		limit = {
			can_build_exploit_power = yes
			count_deposits = { type = d_energy_1 count < 1 }
			check_variable = { which = exploitation_size value > 1 }
		}
		pay_exploit_power = yes
		planet_event = { id = spaceexploit.9 days = 91 }
		planet_event = { id = spaceexploit.202 days = @ConstructionTime }
	}
	else_if = {
		limit = {
			check_variable = { which = exploitation_size value < 1 }
		}
	}
	else = {
		planet_event = { id = spaceexploit.9 days = @ConstructionTime }
	}
}
exploit_crystals_loop = {
	if = {
		limit = {
			NOT = { has_planet_flag = exploit_crystals_loop }
		}
		set_planet_flag = exploit_crystals_loop
	}
	if = {
		limit = {
			can_build_exploit_crystals = yes
		}
		add_modifier = { modifier = building_thing }
		set_planet_flag = all_under_construction
		set_planet_flag = exploit_building_crystals
		pay_exploit_crystals = yes
		planet_event = { id = spaceexploit.8 days = 91 }
		planet_event = { id = spaceexploit.802 days = @ConstructionTime }	
	}
	else_if = {
		limit = {
			can_build_exploit_power = yes
			count_deposits = { type = d_energy_1 count < 1 }
			check_variable = { which = exploitation_size value > 1 }
		}
		pay_exploit_power = yes
		planet_event = { id = spaceexploit.8 days = 91 }
		planet_event = { id = spaceexploit.802 days = @ConstructionTime }
	}
	else_if = {
		limit = {
			check_variable = { which = exploitation_size value < 1 }
		}
	}
	else = {
		planet_event = { id = spaceexploit.8 days = @ConstructionTime }
	}
}


pay_exploit_mine = {
	if = {
		limit = {
			is_base_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegBaseEnergyCost
				alloys = @NegBaseAlloyCost
				minerals = @NegBaseMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_difficult_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegDifficultEnergyCost
				alloys = @NegDifficultAlloyCost
				minerals = @NegDifficultMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_vacuum_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegVacuumEnergyCost
				alloys = @NegVacuumAlloyCost
				minerals = @NegVacuumMineralCost
			}
		}
	}
}
pay_exploit_power = {
	if = {
		limit = {
			is_base_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegBaseEnergyCost
				alloys = @NegBaseAlloyCost
				minerals = @NegBaseMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_difficult_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegDifficultEnergyCost
				alloys = @NegDifficultAlloyCost
				minerals = @NegDifficultMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_vacuum_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegVacuumEnergyCost
				alloys = @NegVacuumAlloyCost
				minerals = @NegVacuumMineralCost
			}
		}
	}
}
pay_exploit_alloy_mine = {
	if = {
		limit = {
			is_base_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegBaseEnergyCost
				alloys = @NegBaseAlloyCost
				minerals = @NegBaseMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_difficult_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegDifficultEnergyCost
				alloys = @NegDifficultAlloyCost
				minerals = @NegDifficultMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_vacuum_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegVacuumEnergyCost
				alloys = @NegVacuumAlloyCost
				minerals = @NegVacuumMineralCost
			}
		}
	}
}
pay_exploit_alloy_foundry = {
	space_owner = {
		add_resource = {
			volatile_motes = @NegBaseSRCost
		}
	}
	if = {
		limit = {
			is_base_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegBaseEnergyCost
				alloys = @NegBaseAlloyCost
				minerals = @NegBaseMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_difficult_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegDifficultEnergyCost
				alloys = @NegDifficultAlloyCost
				minerals = @NegDifficultMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_vacuum_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegVacuumEnergyCost
				alloys = @NegVacuumAlloyCost
				minerals = @NegVacuumMineralCost
			}
		}
	}
}
pay_exploit_lava_refinery = {
	if = {
		limit = {
			is_base_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegAdvancedBaseEnergyCost
				alloys = @NegAdvancedBaseAlloyCost
				minerals = @NegAdvancedBaseMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_difficult_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegAdvancedDifficultEnergyCost
				alloys = @NegAdvancedDifficultAlloyCost
				minerals = @NegAdvancedDifficultMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_vacuum_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegAdvancedVacuumEnergyCost
				alloys = @NegAdvancedVacuumAlloyCost
				minerals = @NegAdvancedVacuumMineralCost
			}
		}
	}
}
pay_exploit_research = {
	space_owner = {
		add_resource = {
			exotic_gases = @NegBaseSRCost
		}
	}
	if = {
		limit = {
			is_base_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegAdvancedBaseEnergyCost
				alloys = @NegAdvancedBaseAlloyCost
				minerals = @NegAdvancedBaseMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_difficult_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegAdvancedDifficultEnergyCost
				alloys = @NegAdvancedDifficultAlloyCost
				minerals = @NegAdvancedDifficultMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_vacuum_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegAdvancedVacuumEnergyCost
				alloys = @NegAdvancedVacuumAlloyCost
				minerals = @NegAdvancedVacuumMineralCost
			}
		}
	}
}
pay_exploit_motes = {
	if = {
		limit = {
			is_base_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegBaseEnergyCost
				alloys = @NegBaseAlloyCost
				minerals = @NegBaseMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_difficult_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegDifficultEnergyCost
				alloys = @NegDifficultAlloyCost
				minerals = @NegDifficultMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_vacuum_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegVacuumEnergyCost
				alloys = @NegVacuumAlloyCost
				minerals = @NegVacuumMineralCost
			}
		}
	}
}
pay_exploit_gases = {
	if = {
		limit = {
			is_base_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegBaseEnergyCost
				alloys = @NegBaseAlloyCost
				minerals = @NegBaseMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_difficult_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegDifficultEnergyCost
				alloys = @NegDifficultAlloyCost
				minerals = @NegDifficultMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_vacuum_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegVacuumEnergyCost
				alloys = @NegVacuumAlloyCost
				minerals = @NegVacuumMineralCost
			}
		}
	}
}
pay_exploit_crystals = {
	if = {
		limit = {
			is_base_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegBaseEnergyCost
				alloys = @NegBaseAlloyCost
				minerals = @NegBaseMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_difficult_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegDifficultEnergyCost
				alloys = @NegDifficultAlloyCost
				minerals = @NegDifficultMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_vacuum_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegVacuumEnergyCost
				alloys = @NegVacuumAlloyCost
				minerals = @NegVacuumMineralCost
			}
		}
	}
}

build_exploit_mine = {
	add_deposit = d_minerals_1
	add_deposit = d_minerals_1
	remove_deposit = d_energy_1
	remove_modifier = building_thing
	remove_planet_flag = exploit_building_mines
	if = {
		limit = {
			OR = {
				is_planet_class = pc_ice_asteroid
				is_planet_class = pc_asteroid
				is_planet_class = pc_rare_crystal_asteroid
			}
		}
		add_deposit = d_minerals_1
		add_deposit = d_minerals_1
	}
	if = {
		limit = {
			is_planet_class = pc_molten
		}
		add_deposit = d_minerals_1
	}
	if = {
		limit = {
			is_inside_nebula = yes
		}
		add_deposit = d_minerals_1
	}
	change_variable = { which = exploitation_size value = -1 }
}
build_exploit_power = {
	add_deposit = d_energy_1
	add_deposit = d_energy_1
	remove_modifier = building_thing
	remove_planet_flag = exploit_building_power
	if = {
		limit = {
			is_planet_class = pc_gas_giant
		}
		add_deposit = d_energy_1
	}
	change_variable = { which = exploitation_size value = -1 }
}
build_exploit_alloy_mine = {
	add_deposit = d_alloys_1
	remove_deposit = d_energy_1
	remove_modifier = building_thing
	remove_planet_flag = exploit_building_alloys
	change_variable = { which = exploitation_size value = -1 }
}
build_exploit_alloy_foundry = {
	add_deposit = d_alloys_1
	remove_deposit = d_energy_1
	remove_deposit = d_minerals_1
	remove_deposit = d_minerals_1
	remove_modifier = building_thing
	remove_planet_flag = exploit_building_foundry
	change_variable = { which = exploitation_size value = -1 }
}
build_exploit_lava_refinery = {
	add_deposit = d_minerals_1
	add_deposit = d_minerals_1
	add_deposit = d_energy_1
	remove_modifier = building_thing
	remove_planet_flag = exploit_building_lava
	random_list = {
		3 = {
			add_deposit = d_alloys_1
		}
		1 = { }
	}
	ROOT = { change_variable = { which = exploitation_size value = -1 } }
}
build_exploit_research = {
	add_deposit = d_society_1
	add_deposit = d_physics_1
	add_deposit = d_engineering_1
	remove_deposit = d_energy_1
	remove_deposit = d_energy_1
	remove_modifier = building_thing
	remove_planet_flag = exploit_building_research
	if = {
		limit = {
			OR = {
				is_planet_class = pc_gas_giant
				is_planet_class = pc_barren
				is_planet_class = pc_barren_cold
			}
		}
		add_deposit = d_physics_1
	}
	if = {
		limit = {
			OR = {
				is_planet_class = pc_molten
				is_planet_class = pc_frozen
			}
		}
		add_deposit = d_engineering_1 
	}
	if = {
		limit = {
			is_planet_class = pc_toxic
		}
		add_deposit = d_society_1 
	}
	ROOT = { change_variable = { which = exploitation_size value = -1 } }
}
build_exploit_motes = {
	add_deposit = d_volatile_motes_1
	remove_deposit = d_energy_1
	remove_deposit = d_energy_1
	remove_modifier = building_thing
	remove_planet_flag = exploit_building_motes
	ROOT = { change_variable = { which = exploitation_size value = -1 } }
}
build_exploit_gases = {
	add_deposit = d_exotic_gases_1
	remove_deposit = d_energy_1
	remove_deposit = d_energy_1
	remove_modifier = building_thing 
	remove_planet_flag = exploit_building_gases
	ROOT = { change_variable = { which = exploitation_size value = -1 } }
}
build_exploit_crystals = {
	add_deposit = d_rare_crystals_1
	remove_deposit = d_energy_1
	remove_deposit = d_energy_1
	remove_modifier = building_thing
	remove_planet_flag = exploit_building_crystals
	ROOT = { change_variable = { which = exploitation_size value = -1 } }
}

