#Planet Scope
colonize_exploit_planet = {
	if = {
		limit = {
			NOT = { has_modifier = colonized_planet }
		}
		add_modifier = { modifier = colonized_planet }
		remove_planet_flag = exploit_colonize_target
		set_variable = { which = exploitation_size value = 0 }
		new_colony_setup = yes
		breakdown_deposits = yes
		exploit_size_set = yes
		if = {
			limit = {
				OR = {
					is_planet_class = pc_gas_giant
					is_planet_class = pc_asteroid
					is_planet_class = pc_ice_asteroid
					
					#PD
					is_planet_class = pc_hot_gas_giant
					is_planet_class = pc_cloudless_gas_giant
					is_planet_class = pc_cold_gas_giant
				}
			}
			exploit_size_set = yes
		}
		if = {
			limit = {
				is_base_planet = yes
				base_planet_cost_check = yes
			}
			space_owner = {
				add_resource = {
					energy = @NegBaseEnergyCost
					alloys = @NegBaseAlloyCost
					minerals = @NegBaseMineralCost
				}
			}
		}
		else_if = {
			limit = {
				is_difficult_planet = yes
				difficult_planet_cost_check = yes
			}
			space_owner = {
				add_resource = {
					energy = @NegDifficultEnergyCost
					alloys = @NegDifficultAlloyCost
					minerals = @NegDifficultMineralCost
				}
			}
		}
		else_if = {
			limit = {
				is_vacuum_planet = yes
				vacuum_planet_cost_check = yes
			}
			space_owner = {
				add_resource = {
					energy = @NegVacuumEnergyCost
					alloys = @NegVacuumAlloyCost
					minerals = @NegVacuumMineralCost
				}
			}
		}
		if = {
			limit = {
				OR = {
					has_perm_flag = yes
					space_owner = { has_country_flag = exploit_automation }
				}
			}
			ai_colony_switch = yes
		}
		solar_system = {
			set_star_flag = exploit_center
		}
		space_owner = {
			capital_scope = {
				fire_on_action = { on_action = on_exploit_colony_completed }
			}
		}
	}
}

#Country Scope
mark_systems_develop = {
	set_variable = { which = exploit_done_today value = 0 }
	set_timed_country_flag = { flag = recent_exploit_apply days = 30 }
	if = {
		limit = {
			check_variable = { which = exploit_done_today value < @ExploitQueueLimit }
			has_country_flag = exploit_automation
			OR = {
				check_variable = { which = exploitation_centers value > 0 }
				is_ai = no
			}
		}
		if = { #Automation Colonizes molten worlds first, since they are really good.
			limit = {
				any_planet_within_border = {
					NOT = { has_modifier = colonized_planet }
					OR = {
						is_planet_class = pc_molten
					}
					can_build_exploit_colony = yes
					has_exploit_technology = yes
					solar_system = {
						OR = {
							system_has_exploit = yes
							system_has_viable_exploit_host = yes
						}
					}
				}
			}
			while = {
				limit = {
					OR = {
						check_variable = { which = exploitation_centers value > 0 }
						is_ai = no
					}
					check_variable = { which = exploit_done_today value < @ExploitQueueLimit }
				}
				change_variable = { which = exploitation_centers value = -1 }
				change_variable = { which = exploit_done_today value = 1 }
				ordered_planet_within_border = {
					limit = {
						NOT = { has_modifier = colonized_planet }
						is_planet_class = pc_molten
						can_build_exploit_colony = yes
						has_exploit_technology = yes
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_colonize_target
					#colonize_exploit_planet = yes
				}
			}
		}
		else = { #Automation colonizes all trade_value planets by planet size.
			while = {
				limit = {
					OR = {
						check_variable = { which = exploitation_centers value > 0 }
						is_ai = no
					}
					check_variable = { which = exploit_done_today value < @ExploitQueueLimit }
				}
				change_variable = { which = exploitation_centers value = -1 }
				change_variable = { which = exploit_done_today value = 1 }
				ordered_planet_within_border = {
					limit = {
						NOT = { has_modifier = colonized_planet }
						can_build_exploit_colony = yes
						has_exploit_technology = yes
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_colonize_target
					#colonize_exploit_planet = yes
				}
			}
		}
	}
	else_if = {
		limit = {
			check_variable = { which = exploit_done_today value < @ExploitQueueLimit }
			NOT = { has_country_flag = exploit_automation }
			has_exploit_queue = yes
			OR = {
				check_variable = { which = exploitation_centers value > 0 }
				is_ai = no
			}
		}
		#Add while loops for each queue using ordered_planet_within_border to get the largest planet that fits the bill
		while = { #Energy Loop
			limit = {
				check_variable = { which = exploit_power_plant_queue value > 0 }
				check_variable = { which = exploit_done_today value < @ExploitQueueLimit }
				any_planet_within_border = {
					system_has_colonizeable_power_planet = yes
					NOT = { has_deposit_for = shipclass_research_station }
					solar_system = {
						OR = {
							system_has_exploit = yes
							system_has_viable_exploit_host = yes
						}
					}
				}
			}
			change_variable = { which = exploit_done_today value = 1 }
			change_variable = { which = exploit_power_plant_queue value = -1 }
			if = {
				limit = {
					any_planet_within_border = {
						system_has_colonizeable_power_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_energy_deposit = yes
					}
				}
				ordered_planet_within_border = {
					limit = {
						system_has_colonizeable_power_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_energy_deposit = yes
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_power_loop
					set_planet_flag = exploit_colonize_target
				}
			}
			else_if = {
				limit = {
					any_planet_within_border = {
						system_has_colonizeable_power_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_deposit = no
					}
				}
				ordered_planet_within_border = {
					limit = {
						system_has_colonizeable_power_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_deposit = no
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_power_loop
					set_planet_flag = exploit_colonize_target
				}
			}
		}
		
		while = { #Mineral Loop
			limit = {
				check_variable = { which = exploit_mineral_mine_queue value > 0 }
				check_variable = { which = exploit_done_today value < @ExploitQueueLimit }
				any_planet_within_border = {
					system_has_colonizeable_mine_planet = yes
					NOT = { has_deposit_for = shipclass_research_station }
					solar_system = {
						OR = {
							system_has_exploit = yes
							system_has_viable_exploit_host = yes
						}
					}
				}
			}
			change_variable = { which = exploit_done_today value = 1 }
			change_variable = { which = exploit_mineral_mine_queue value = -1 }
			if = {
				limit = {
					any_planet_within_border = {
						system_has_colonizeable_mine_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_mineral_deposit = yes
					}
				}
				ordered_planet_within_border = {
					limit = {
						system_has_colonizeable_mine_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_mineral_deposit = yes
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_mine_loop
					set_planet_flag = exploit_colonize_target
				}
			}
			else_if = {
				limit = {
					any_planet_within_border = {
						system_has_colonizeable_mine_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_energy_deposit = yes
					}
				}
				ordered_planet_within_border = {
					limit = {
						system_has_colonizeable_mine_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_energy_deposit = yes
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_mine_loop
					set_planet_flag = exploit_colonize_target
				}
			}
			else_if = {
				limit = {
					any_planet_within_border = {
						system_has_colonizeable_mine_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_deposit = no
					}
				}
				ordered_planet_within_border = {
					limit = {
						system_has_colonizeable_mine_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_deposit = no
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_mine_loop
					set_planet_flag = exploit_colonize_target
				}
			}
		}
		
		while = { #Alloy Mine Loop
			limit = {
				check_variable = { which = exploit_alloy_queue value > 0 }
				check_variable = { which = exploit_done_today value < @ExploitQueueLimit }
				any_planet_within_border = {
					system_has_colonizeable_alloy_planet = yes
					NOT = { has_deposit_for = shipclass_research_station }
					solar_system = {
						OR = {
							system_has_exploit = yes
							system_has_viable_exploit_host = yes
						}
					}
				}
			}
			change_variable = { which = exploit_done_today value = 1 }
			change_variable = { which = exploit_alloy_queue value = -1 }
			if = {
				limit = {
					any_planet_within_border = {
						system_has_colonizeable_alloy_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_alloy_deposit = yes
					}
				}
				ordered_planet_within_border = {
					limit = {
						system_has_colonizeable_alloy_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_alloy_deposit = yes
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_alloy_mine_loop
					set_planet_flag = exploit_colonize_target
				}
			}
			else_if = {
				limit = {
					any_planet_within_border = {
						system_has_colonizeable_alloy_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_mineral_deposit = yes
					}
				}
				ordered_planet_within_border = {
					limit = {
						system_has_colonizeable_alloy_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_mineral_deposit = yes
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_alloy_mine_loop
					set_planet_flag = exploit_colonize_target
				}
			}
			else_if = {
				limit = {
					any_planet_within_border = {
						system_has_colonizeable_alloy_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_energy_deposit = yes
					}
				}
				ordered_planet_within_border = {
					limit = {
						system_has_colonizeable_alloy_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_energy_deposit = yes
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_alloy_mine_loop
					set_planet_flag = exploit_colonize_target
				}
			}
			else_if = {
				limit = {
					any_planet_within_border = {
						system_has_colonizeable_alloy_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_deposit = no
					}
				}
				ordered_planet_within_border = {
					limit = {
						system_has_colonizeable_alloy_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_deposit = no
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_alloy_mine_loop
					set_planet_flag = exploit_colonize_target
				}
			}
		}
		
		while = { #Alloy Foundry Loop
			limit = {
				check_variable = { which = exploit_foundry_queue value > 0 }
				check_variable = { which = exploit_done_today value < @ExploitQueueLimit }
				any_planet_within_border = {
					system_has_colonizeable_foundry_planet = yes
					NOT = { has_deposit_for = shipclass_research_station }
					solar_system = {
						OR = {
							system_has_exploit = yes
							system_has_viable_exploit_host = yes
						}
					}
				}
			}
			change_variable = { which = exploit_done_today value = 1 }
			change_variable = { which = exploit_foundry_queue value = -1 }
			if = {
				limit = {
					any_planet_within_border = {
						system_has_colonizeable_foundry_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_alloy_deposit = yes
					}
				}
				ordered_planet_within_border = {
					limit = {
						system_has_colonizeable_foundry_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_alloy_deposit = yes
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_alloy_foundry_loop
					set_planet_flag = exploit_colonize_target
				}
			}
			else_if = {
				limit = {
					any_planet_within_border = {
						system_has_colonizeable_foundry_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_mineral_deposit = yes
					}
				}
				ordered_planet_within_border = {
					limit = {
						system_has_colonizeable_foundry_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_mineral_deposit = yes
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_alloy_foundry_loop
					set_planet_flag = exploit_colonize_target
				}
			}
			else_if = {
				limit = {
					any_planet_within_border = {
						system_has_colonizeable_foundry_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_energy_deposit = yes
					}
				}
				ordered_planet_within_border = {
					limit = {
						system_has_colonizeable_foundry_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_energy_deposit = yes
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_alloy_foundry_loop
					set_planet_flag = exploit_colonize_target
				}
			}
			else_if = {
				limit = {
					any_planet_within_border = {
						system_has_colonizeable_foundry_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_deposit = no
					}
				}
				ordered_planet_within_border = {
					limit = {
						system_has_colonizeable_foundry_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_deposit = no
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_alloy_foundry_loop
					set_planet_flag = exploit_colonize_target
				}
			}
		}
		
		while = { #Lava Refinery Loop
			limit = {
				check_variable = { which = exploit_lava_refinery_queue value > 0 }
				check_variable = { which = exploit_done_today value < @ExploitQueueLimit }
				any_planet_within_border = {
					system_has_colonizeable_lava_planet = yes
					NOT = { has_deposit_for = shipclass_research_station }
					solar_system = {
						OR = {
							system_has_exploit = yes
							system_has_viable_exploit_host = yes
						}
					}
				}
			}
			change_variable = { which = exploit_done_today value = 1 }
			change_variable = { which = exploit_lava_refinery_queue value = -1 }
			ordered_planet_within_border = {
				limit = {
					system_has_colonizeable_lava_planet = yes
					NOT = { has_deposit_for = shipclass_research_station }
					solar_system = {
						OR = {
							system_has_exploit = yes
							system_has_viable_exploit_host = yes
						}
					}
				}
				position = 0
				order_by = trigger:planet_size
				set_planet_flag = exploit_lava_refinery_loop
				set_planet_flag = exploit_colonize_target
			}
		}
		
		while = { #Research Loop
			limit = {
				check_variable = { which = exploit_research_queue value > 0 }
				check_variable = { which = exploit_done_today value < @ExploitQueueLimit }
				any_planet_within_border = {
					system_has_colonizeable_research_planet = yes
					solar_system = {
						OR = {
							system_has_exploit = yes
							system_has_viable_exploit_host = yes
						}
					}
				}
			}
			change_variable = { which = exploit_done_today value = 1 }
			change_variable = { which = exploit_research_queue value = -1 }
			if = {
				limit = {
					any_planet_within_border = {
						system_has_colonizeable_research_planet = yes
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_deposit_for = shipclass_research_station
					}
				}
				ordered_planet_within_border = {
					limit = {
						system_has_colonizeable_research_planet = yes
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_deposit_for = shipclass_research_station
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_research_loop
					set_planet_flag = exploit_colonize_target
				}
			}
			else_if = {
				limit = {
					any_planet_within_border = {
						system_has_colonizeable_research_planet = yes
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_energy_deposit = yes
					}
				}
				ordered_planet_within_border = {
					limit = {
						system_has_colonizeable_research_planet = yes
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_energy_deposit = yes
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_research_loop
					set_planet_flag = exploit_colonize_target
				}
			}
			else_if = {
				limit = {
					any_planet_within_border = {
						system_has_colonizeable_research_planet = yes
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_deposit = no
					}
				}
				ordered_planet_within_border = {
					limit = {
						system_has_colonizeable_research_planet = yes
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_deposit = no
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_research_loop
					set_planet_flag = exploit_colonize_target
				}
			}
		}
		
		while = { #Motes Loop
			limit = {
				has_technology = tech_mine_volatile_motes
				check_variable = { which = exploit_motes_queue value > 0 }
				check_variable = { which = exploit_done_today value < @ExploitQueueLimit }
				any_planet_within_border = {
					system_has_colonizeable_mote_planet = yes
					NOT = { has_deposit_for = shipclass_research_station }
					solar_system = {
						OR = {
							system_has_exploit = yes
							system_has_viable_exploit_host = yes
						}
					}
				}
			}
			change_variable = { which = exploit_done_today value = 1 }
			change_variable = { which = exploit_motes_queue value = -1 }
			if = {
				limit = {
					any_planet_within_border = {
						system_has_colonizeable_mote_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_motes_deposit = yes
					}
				}
				ordered_planet_within_border = {
					limit = {
						system_has_colonizeable_mote_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_motes_deposit = yes
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_motes_loop
					set_planet_flag = exploit_colonize_target
				}
			}
			else_if = {
				limit = {
					any_planet_within_border = {
						system_has_colonizeable_mote_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_energy_deposit = yes
					}
				}
				ordered_planet_within_border = {
					limit = {
						system_has_colonizeable_mote_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_energy_deposit = yes
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_motes_loop
					set_planet_flag = exploit_colonize_target
				}
			}
			else_if = {
				limit = {
					any_planet_within_border = {
						system_has_colonizeable_mote_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_deposit = no
					}
				}
				ordered_planet_within_border = {
					limit = {
						system_has_colonizeable_mote_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_deposit = no
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_motes_loop
					set_planet_flag = exploit_colonize_target
				}
			}
		}
		
		while = { #Gases Loop
			limit = {
				has_technology = tech_mine_exotic_gases
				check_variable = { which = exploit_gases_queue value > 0 }
				check_variable = { which = exploit_done_today value < @ExploitQueueLimit }
				any_planet_within_border = {
					system_has_colonizeable_gas_planet = yes
					NOT = { has_deposit_for = shipclass_research_station }
					solar_system = {
						OR = {
							system_has_exploit = yes
							system_has_viable_exploit_host = yes
						}
					}
				}
			}
			change_variable = { which = exploit_done_today value = 1 }
			change_variable = { which = exploit_gases_queue value = -1 }
			if = {
				limit = {
					any_planet_within_border = {
						system_has_colonizeable_gas_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_gas_deposit = yes
					}
				}
				ordered_planet_within_border = {
					limit = {
						system_has_colonizeable_gas_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_gas_deposit = yes
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_gases_loop
					set_planet_flag = exploit_colonize_target
				}
			}
			else_if = {
				limit = {
					any_planet_within_border = {
						system_has_colonizeable_gas_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_energy_deposit = yes
					}
				}
				ordered_planet_within_border = {
					limit = {
						system_has_colonizeable_gas_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_energy_deposit = yes
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_gases_loop
					set_planet_flag = exploit_colonize_target
				}
			}
			else_if = {
				limit = {
					any_planet_within_border = {
						system_has_colonizeable_gas_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_deposit = no
					}
				}
				ordered_planet_within_border = {
					limit = {
						system_has_colonizeable_gas_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_deposit = no
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_gases_loop
					set_planet_flag = exploit_colonize_target
				}
			}
		}
		
		while = { #Crystals Loop
			limit = {
				has_technology = tech_mine_rare_crystals
				check_variable = { which = exploit_crystals_queue value > 0 }
				check_variable = { which = exploit_done_today value < @ExploitQueueLimit }
				any_planet_within_border = {
					system_has_colonizeable_crystal_planet = yes
					NOT = { has_deposit_for = shipclass_research_station }
					solar_system = {
						OR = {
							system_has_exploit = yes
							system_has_viable_exploit_host = yes
						}
					}
				}
			}
			change_variable = { which = exploit_done_today value = 1 }
			change_variable = { which = exploit_crystals_queue value = -1 }
			if = {
				limit = {
					any_planet_within_border = {
						system_has_colonizeable_crystal_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_crystal_deposit = yes
					}
				}
				ordered_planet_within_border = {
					limit = {
						system_has_colonizeable_crystal_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_crystal_deposit = yes
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_crystals_loop
					set_planet_flag = exploit_colonize_target
				}
			}
			else_if = {
				limit = {
					any_planet_within_border = {
						system_has_colonizeable_crystal_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_energy_deposit = yes
					}
				}
				ordered_planet_within_border = {
					limit = {
						system_has_colonizeable_crystal_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_energy_deposit = yes
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_crystals_loop
					set_planet_flag = exploit_colonize_target
				}
			}
			else_if = {
				limit = {
					any_planet_within_border = {
						system_has_colonizeable_crystal_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_deposit = no
					}
				}
				ordered_planet_within_border = {
					limit = {
						system_has_colonizeable_crystal_planet = yes
						NOT = { has_deposit_for = shipclass_research_station }
						solar_system = {
							OR = {
								system_has_exploit = yes
								system_has_viable_exploit_host = yes
							}
						}
						has_deposit = no
					}
					position = 0
					order_by = trigger:planet_size
					set_planet_flag = exploit_crystals_loop
					set_planet_flag = exploit_colonize_target
				}
			}
		}
	}
	country_event = { id = spaceexploitAI.1 days = 1 }
}

#Country Scope
calculate_allowed_exploits = {
	set_variable = { which = exploitation_centers value = 0 }
	set_country_flag = exploitation_set
	every_owned_planet = {
		limit = {
			is_major_colony = yes
		}
		PREV = { change_variable = { which = exploitation_centers value = 3 } }
		if = {
			limit = {
				years_passed > 5
			}
			PREV = { change_variable = { which = exploitation_centers value = 1 } }
		}
		if = {
			limit = {
				years_passed > 10
			}
			PREV = { change_variable = { which = exploitation_centers value = 1 } }
		}
		if = {
			limit = {
				years_passed > 15
			}
			PREV = { change_variable = { which = exploitation_centers value = 1 } }
		}
		if = {
			limit = {
				years_passed > 20
			}
			PREV = { change_variable = { which = exploitation_centers value = 1 } }
		}
	}
	if = {
		limit = {
			is_ai = yes
		}
		if = {
			limit = {
				has_global_flag = exploit_speed_difficulty
			}
			switch = {
				trigger = is_difficulty
				0 = {
					multiply_variable = { which = exploitation_centers value = 0.5 }
				}
				1 = {
				}
				2 = {
					multiply_variable = { which = exploitation_centers value = 2 }
				}
				3 = {
					multiply_variable = { which = exploitation_centers value = 3 }
				}
				4 = {
					multiply_variable = { which = exploitation_centers value = 4 }
				}
				5 = {
					multiply_variable = { which = exploitation_centers value = 5 }
				}
			}
		}
		else_if = {
			limit = {
				has_global_flag = exploit_speed_manual
			}
			switch = {
				trigger = has_global_flag
				exploit_ai_speed_5_neg = {
					divide_variable = { which = exploitation_centers value = 6 }
				}
				exploit_ai_speed_4_neg = {
					divide_variable = { which = exploitation_centers value = 5 }
				}
				exploit_ai_speed_3_neg = {
					divide_variable = { which = exploitation_centers value = 4 }
				}
				exploit_ai_speed_2_neg = {
					divide_variable = { which = exploitation_centers value = 3 }
				}
				exploit_ai_speed_1_neg = {
					divide_variable = { which = exploitation_centers value = 2 }
				}
				
				exploit_ai_speed_1 = {
					multiply_variable = { which = exploitation_centers value = 2 }
				}
				exploit_ai_speed_2 = {
					multiply_variable = { which = exploitation_centers value = 3 }
				}
				exploit_ai_speed_3 = {
					multiply_variable = { which = exploitation_centers value = 4 }
				}
				exploit_ai_speed_4 = {
					multiply_variable = { which = exploitation_centers value = 5 }
				}
				exploit_ai_speed_5 = {
					multiply_variable = { which = exploitation_centers value = 6 }
				}
			}
		}
		else = {
		}
	}
	every_planet_within_border = {
		limit = {
			has_modifier = colonized_planet
			OR = {
				has_modifier = roci_building_thing
				has_perm_flag = yes
			}
		}
		PREV = { change_variable = { which = exploitation_centers value = -1 } }
	}
}

#Planet Scope
exploit_build_time_calc = {
	if = {
		limit = {
			check_variable = { which = exploit_build_time value > 0 }
		}
		if = {
			limit = {
				check_variable = { which = exploit_build_time value >= 60 }
			}
			planet_event = { id = spaceexploit.20 days = 60 }
			set_variable = { which = exploit_build_progress value = 60 }
			multiply_variable = { which = exploit_build_progress value = space_owner.realdev_minor_colony_speed }
			subtract_variable = { which = exploit_build_time value = exploit_build_progress }
		}
		else_if = {
			limit = {
				check_variable = { which = exploit_build_time value >= 30 }
			}
			planet_event = { id = spaceexploit.20 days = 30 }
			set_variable = { which = exploit_build_progress value = 30 }
			multiply_variable = { which = exploit_build_progress value = space_owner.realdev_minor_colony_speed }
			subtract_variable = { which = exploit_build_time value = exploit_build_progress }
		}
		else_if = {
			limit = {
				check_variable = { which = exploit_build_time value >= 15 }
			}
			planet_event = { id = spaceexploit.20 days = 15 }
			set_variable = { which = exploit_build_progress value = 15 }
			multiply_variable = { which = exploit_build_progress value = space_owner.realdev_minor_colony_speed }
			subtract_variable = { which = exploit_build_time value = exploit_build_progress }
		}
		else_if = {
			limit = {
				check_variable = { which = exploit_build_time value >= 5 }
			}
			planet_event = { id = spaceexploit.20 days = 5 }
			set_variable = { which = exploit_build_progress value = 5 }
			multiply_variable = { which = exploit_build_progress value = space_owner.realdev_minor_colony_speed }
			subtract_variable = { which = exploit_build_time value = exploit_build_progress }
		}
		else_if = {
			limit = {
				check_variable = { which = exploit_build_time value >= 1 }
			}
			planet_event = { id = spaceexploit.20 days = 1 }
			set_variable = { which = exploit_build_progress value = 1 }
			multiply_variable = { which = exploit_build_progress value = space_owner.realdev_minor_colony_speed }
			subtract_variable = { which = exploit_build_time value = exploit_build_progress }
		}
		else_if = {
			limit = {
				check_variable = { which = exploit_build_time value > 0 }
			}
			planet_event = { id = spaceexploit.20 days = 1 }
			set_variable = { which = exploit_build_time value = 0 }
		}
	}
	else = {
		exploit_build_switch = yes
	}
}
#Planet Scope - When the build loop is done, it triggers this to fire the correct loop event, and the correct Construction Finished event
exploit_build_switch = {
	switch = {
		trigger = has_planet_flag
		exploit_building_mines = {
			planet_event = { id = spaceexploit.102 }
		}
		exploit_building_power = {
			planet_event = { id = spaceexploit.202 }
		}
		exploit_building_foundry = {
			planet_event = { id = spaceexploit.402 }
		}
		exploit_building_alloys = {
			planet_event = { id = spaceexploit.502 }
		}
		exploit_building_motes = {
			planet_event = { id = spaceexploit.702 }
		}
		exploit_building_gases = {
			planet_event = { id = spaceexploit.902 }
		}
		exploit_building_crystals = {
			planet_event = { id = spaceexploit.802 }
		}
		exploit_building_lava = {
			planet_event = { id = spaceexploit.1002 }
		}
		exploit_building_research = {
			planet_event = { id = spaceexploit.1202 }
		}
	}
	switch = {
		trigger = has_planet_flag
		exploit_mine_loop = {
			planet_event = { id = spaceexploit.1 }
		}
		exploit_power_loop = {
			planet_event = { id = spaceexploit.2 }
		}
		exploit_alloy_foundry_loop = {
			planet_event = { id = spaceexploit.4 }
		}
		exploit_alloy_mine_loop = {
			planet_event = { id = spaceexploit.5 }
		}
		exploit_motes_loop = {
			planet_event = { id = spaceexploit.7 }
		}
		exploit_gases_loop = {
			planet_event = { id = spaceexploit.9 }
		}
		exploit_crystals_loop = {
			planet_event = { id = spaceexploit.8 }
		}
		exploit_lava_refinery_loop = {
			planet_event = { id = spaceexploit.10 }
		}
		exploit_research_loop = {
			planet_event = { id = spaceexploit.12 }
		}
	}
}

exploit_start_construction_effect = {
	add_modifier = { modifier = roci_building_thing }
	set_variable = { which = exploit_build_time value = @ConstructionTime }
	set_planet_flag = exploit_building_$exploit_type$
	set_planet_flag = exploit_$exploit_type_batch$_batch
	planet_event = { id = spaceexploit.20 }
	fire_on_action = { on_action = on_exploit_construction_started scopes = { from = space_owner } }
}
exploit_finish_construction_effect = {
	remove_modifier = roci_building_thing
	change_variable = { which = exploitation_size value = -1 }
	remove_planet_flag = exploit_building_$module_type$
	fire_on_action = { on_action = on_exploit_construction_completed scopes = { from = space_owner } }
}


#Planet Scope
pay_exploit_mine = {
	remove_planet_flag = exploit_mine_batch
	if = {
		limit = {
			is_base_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegBaseEnergyCost
				alloys = @NegBaseAlloyCost
				minerals = @NegBaseMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_difficult_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegDifficultEnergyCost
				alloys = @NegDifficultAlloyCost
				minerals = @NegDifficultMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_vacuum_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegVacuumEnergyCost
				alloys = @NegVacuumAlloyCost
				minerals = @NegVacuumMineralCost
			}
		}
	}
}
pay_exploit_power = {
	remove_planet_flag = exploit_power_batch
	if = {
		limit = {
			is_base_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegBaseEnergyCost
				alloys = @NegBaseAlloyCost
				minerals = @NegBaseMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_difficult_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegDifficultEnergyCost
				alloys = @NegDifficultAlloyCost
				minerals = @NegDifficultMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_vacuum_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegVacuumEnergyCost
				alloys = @NegVacuumAlloyCost
				minerals = @NegVacuumMineralCost
			}
		}
	}
}
pay_exploit_alloy_mine = {
	remove_planet_flag = exploit_alloy_mine_batch
	if = {
		limit = {
			is_base_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegBaseEnergyCost
				alloys = @NegBaseAlloyCost
				minerals = @NegBaseMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_difficult_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegDifficultEnergyCost
				alloys = @NegDifficultAlloyCost
				minerals = @NegDifficultMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_vacuum_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegVacuumEnergyCost
				alloys = @NegVacuumAlloyCost
				minerals = @NegVacuumMineralCost
			}
		}
	}
}
pay_exploit_alloy_foundry = {
	remove_planet_flag = exploit_alloy_foundry_batch
	if = {
		limit = {
			is_base_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegBaseEnergyCost
				alloys = @NegBaseAlloyCost
				minerals = @NegBaseMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_difficult_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegDifficultEnergyCost
				alloys = @NegDifficultAlloyCost
				minerals = @NegDifficultMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_vacuum_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegVacuumEnergyCost
				alloys = @NegVacuumAlloyCost
				minerals = @NegVacuumMineralCost
			}
		}
	}
}
pay_exploit_lava_refinery = {
	remove_planet_flag = exploit_lava_refinery_batch
	if = {
		limit = {
			is_base_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegAdvancedBaseEnergyCost
				alloys = @NegAdvancedBaseAlloyCost
				minerals = @NegAdvancedBaseMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_difficult_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegAdvancedDifficultEnergyCost
				alloys = @NegAdvancedDifficultAlloyCost
				minerals = @NegAdvancedDifficultMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_vacuum_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegAdvancedVacuumEnergyCost
				alloys = @NegAdvancedVacuumAlloyCost
				minerals = @NegAdvancedVacuumMineralCost
			}
		}
	}
}
pay_exploit_research = {
	remove_planet_flag = exploit_research_batch
	if = {
		limit = {
			is_base_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegAdvancedBaseEnergyCost
				alloys = @NegAdvancedBaseAlloyCost
				minerals = @NegAdvancedBaseMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_difficult_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegAdvancedDifficultEnergyCost
				alloys = @NegAdvancedDifficultAlloyCost
				minerals = @NegAdvancedDifficultMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_vacuum_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegAdvancedVacuumEnergyCost
				alloys = @NegAdvancedVacuumAlloyCost
				minerals = @NegAdvancedVacuumMineralCost
			}
		}
	}
}
pay_exploit_motes = {
	remove_planet_flag = exploit_motes_batch
	if = {
		limit = {
			is_base_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegBaseEnergyCost
				alloys = @NegBaseAlloyCost
				minerals = @NegBaseMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_difficult_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegDifficultEnergyCost
				alloys = @NegDifficultAlloyCost
				minerals = @NegDifficultMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_vacuum_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegVacuumEnergyCost
				alloys = @NegVacuumAlloyCost
				minerals = @NegVacuumMineralCost
			}
		}
	}
}
pay_exploit_gases = {
	remove_planet_flag = exploit_gases_batch
	if = {
		limit = {
			is_base_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegBaseEnergyCost
				alloys = @NegBaseAlloyCost
				minerals = @NegBaseMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_difficult_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegDifficultEnergyCost
				alloys = @NegDifficultAlloyCost
				minerals = @NegDifficultMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_vacuum_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegVacuumEnergyCost
				alloys = @NegVacuumAlloyCost
				minerals = @NegVacuumMineralCost
			}
		}
	}
}
pay_exploit_crystals = {
	remove_planet_flag = exploit_crystals_batch
	if = {
		limit = {
			is_base_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegBaseEnergyCost
				alloys = @NegBaseAlloyCost
				minerals = @NegBaseMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_difficult_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegDifficultEnergyCost
				alloys = @NegDifficultAlloyCost
				minerals = @NegDifficultMineralCost
			}
		}
	}
	else_if = {
		limit = {
			is_vacuum_planet = yes
		}
		space_owner = {
			add_resource = {
				energy = @NegVacuumEnergyCost
				alloys = @NegVacuumAlloyCost
				minerals = @NegVacuumMineralCost
			}
		}
	}
}

