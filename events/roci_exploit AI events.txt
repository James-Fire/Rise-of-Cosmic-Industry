namespace = spaceexploitAI

event = {
	id = spaceexploitAI.1000
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_global_flag = no_exploit }
	}
	
	immediate = {
		every_country = {
			limit = {
				is_country_type = default
				NOT = { has_global_flag = no_exploit }
			}
			country_event = { id = spaceexploitAI.1001 days = 3 random = 25 }
		}
	}
}
country_event = {
	id = spaceexploitAI.1001
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_global_flag = no_exploit }
	}
	
	immediate = {
		export_to_exploit_variables = yes #Disabled because script values might replace its functionality
		document_minor_colonies = yes
	}
	
}
event = {
	id = spaceexploitAI.10000
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_global_flag = no_exploit }
	}
	
	immediate = {
		every_country = {
			limit = {
				is_country_type = default
				NOT = { has_global_flag = no_exploit }
			}
			export_to_exploit_variables = yes
		}
		every_country = {
			limit = {
				NOT = { has_global_flag = no_exploit }
				NOT = { has_country_flag = recent_exploit_apply }
				is_country_type = default
				OR = {
					AND = {
						is_ai = yes
						NOT = { has_global_flag = exploit_ai_off }
					}
					AND = {
						is_ai = no
						OR = {
							has_exploit_queue = yes
							any_owned_planet = {
								has_exploit_batch_flag = yes
							}
							has_country_flag = exploit_automation
						}
					}
				}
				any_planet_within_border = {
					can_build_exploit_colony = yes
					OR = {
						uninhabitable_regular_planet = yes
						is_planet_class = pc_gas_giant
						is_planet_class = pc_asteroid
						is_planet_class = pc_ice_asteroid
						is_planet_class = pc_rare_crystal_asteroid
						is_planet_class = pc_shattered
						is_planet_class = pc_shattered_2
					}
					NOT = {
						has_modifier = colonized_planet
					}
				}
			}
			fire_on_action = { on_action = exploit_apply_queue }
		}
	}
}

country_event = {
	id = spaceexploitAI.10001
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_global_flag = no_exploit }
	}
	
	immediate = {
		if = {
			limit = {
				has_global_flag = exploitation_logging
			}
			log = "Apply Exploit Queue for [This.GetName]"
		}
		random_list = {
			10 = {
				country_event = { id = spaceexploitAI.0 days = 2 }
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					log = "2 day delay Apply Exploit Queue for [This.GetName]"
				}
			}
			10 = {
				country_event = { id = spaceexploitAI.0 days = 32 }
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					log = "32 day delay Apply Exploit Queue for [This.GetName]"
				}
			}
			10 = {
				country_event = { id = spaceexploitAI.0 days = 62 }
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					log = "62 day delay Apply Exploit Queue for [This.GetName]"
				}
			}
			10 = {
				country_event = { id = spaceexploitAI.0 days = 92 }
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					log = "92 day delay Apply Exploit Queue for [This.GetName]"
				}
			}
			10 = {
				country_event = { id = spaceexploitAI.0 days = 122 }
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					log = "122 day delay Apply Exploit Queue for [This.GetName]"
				}
			}
			10 = {
				country_event = { id = spaceexploitAI.0 days = 152 }
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					log = "152 day delay Apply Exploit Queue for [This.GetName]"
				}
			}
			10 = {
				country_event = { id = spaceexploitAI.0 days = 182 }
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					log = "182 day delay Apply Exploit Queue for [This.GetName]"
				}
			}
			10 = {
				country_event = { id = spaceexploitAI.0 days = 212 }
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					log = "212 day delay Apply Exploit Queue for [This.GetName]"
				}
			}
			10 = {
				country_event = { id = spaceexploitAI.0 days = 242 }
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					log = "242 day delay Apply Exploit Queue for [This.GetName]"
				}
			}
			10 = {
				country_event = { id = spaceexploitAI.0 days = 272 }
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					log = "272 day delay Apply Exploit Queue for [This.GetName]"
				}
			}
			10 = {
				country_event = { id = spaceexploitAI.0 days = 302 }
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					log = "302 day delay Apply Exploit Queue for [This.GetName]"
				}
			}
			10 = {
				country_event = { id = spaceexploitAI.0 days = 332 }
				if = {
					limit = {
						has_global_flag = exploitation_logging
					}
					log = "332 day delay Apply Exploit Queue for [This.GetName]"
				}
			}
		}
	}
}

country_event = {
	id = spaceexploitAI.0
	hide_window = yes
	is_triggered_only = yes
	location = ROOT
	
	trigger = {
		NOT = { has_global_flag = no_exploit }
	}
	
	immediate = {
		if = {
			limit = {
				is_ai = yes
			}
			calculate_allowed_exploits = yes
		}
		export_to_exploit_variables = yes
		country_event = { id = spaceexploitAI.1 days = 1 }
	}
	after = {
	}
}
country_event = {
	id = spaceexploitAI.1
	hide_window = yes
	is_triggered_only = yes
	location = ROOT
	
	trigger = {
		NOT = { has_global_flag = no_exploit }
	}
	
	immediate = {
		if = {
			limit = {
				has_global_flag = exploitation_logging
			}
			log = "Find minor colony targets for [This.GetName]"
		}
		if = {
			limit = {
				OR = {
					check_variable = { which = exploitation_centers value > 0 }
					is_ai = no
				}
				OR = {
					has_exploit_queue = yes
					AND = {
						has_country_flag = exploit_automation
						any_planet_within_border = {
							NOT = { has_modifier = colonized_planet }
							can_build_exploit_colony = yes
							has_exploit_technology = yes
							solar_system = {
								OR = {
									system_has_exploit = yes
									system_has_viable_exploit_host = yes
								}
							}
						}
					}
				}
			}
			mark_systems_develop = yes
		}
		else = {
			country_event = { id = spaceexploitAI.2 days = 1 }
		}
	}
}
country_event = {
	id = spaceexploitAI.11
	hide_window = yes
	is_triggered_only = yes
	location = ROOT
	
	trigger = {
		NOT = { has_global_flag = no_exploit }
		any_planet_within_border = {
			can_build_exploit_colony = yes
			has_exploit_batch_flag = yes
			NOT = { has_planet_flag = exploit_batch_delayed }
		}
	}
	
	immediate = {
		if = {
			limit = {
				has_global_flag = exploitation_logging
			}
			log = "Exploit Batch for [This.GetName]"
		}
		set_variable = { which = exploit_batch_done_today value = 0 }
		while = {
			limit = {
				check_variable = { which = exploit_batch_done_today value < @ExploitQueueLimit }
				any_planet_within_border = {
					OR = {
						can_build_exploit_colony = yes
						has_exploit_batch_flag = yes
					}
					NOT = { has_planet_flag = exploit_batch_delayed }
				}
			}
			export_to_exploit_variables = yes #Disabled because script values might replace its functionality.
			change_variable = { which = exploit_batch_done_today value = 1 }
			random_planet_within_border = {
				limit = {
					OR = {
						can_build_exploit_colony = yes
						has_exploit_batch_flag = yes
					}
					NOT = { has_planet_flag = exploit_batch_delayed }
				}
				exploit_batch_switch = yes
			}
		}
		if = {
			limit = {
				any_planet_within_border = {
					has_exploit_batch_flag = yes
					NOT = { has_planet_flag = exploit_batch_delayed }
				}
			}
			country_event = { id = spaceexploitAI.11 days = 1 }
		}
		else = {
			country_event = { id = spaceexploitAI.2 days = 1 }
		}
	}
}

country_event = {
	id = spaceexploitAI.2
	hide_window = yes
	is_triggered_only = yes
	location = ROOT
	
	trigger = {
		NOT = { has_global_flag = no_exploit }
	}
	
	immediate = {
		#every_system_within_border = {
		#	limit = {
		#		has_star_flag = exploit_colonize_target
		#	}
		#	system_event = { id = spaceexploitAI.4 days = 3 }		
		#}
		every_planet_within_border = {
			limit = {
				has_planet_flag = exploit_colonize_target
			}
			random_list = {
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 1 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 2 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 3 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 4 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 5 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 6 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 7 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 8 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 9 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 10 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 11 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 12 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 13 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 14 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 15 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 16 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 17 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 18 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 19 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 20 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 21 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 22 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 23 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 24 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 25 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 26 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 27 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 28 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 29 }
				}
				10 = {
					planet_event = { id = spaceexploitAI.3 days = 30 }
				}
			}
		}
	}
}

planet_event = {
	id = spaceexploitAI.3
	hide_window = yes
	is_triggered_only = yes
	location = ROOT
	
	trigger = {
		NOT = { has_global_flag = no_exploit }
	}
	
	immediate = {
		if = {
			limit = {
				has_global_flag = exploitation_logging
			}
			log = "Colonize [This.GetName] for [space_owner.GetName]"
		}
		colonize_exploit_planet = yes
	}
}